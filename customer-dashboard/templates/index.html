<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Fleet Customer Dashboard</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; font-family: 'Arial', sans-serif; background-color: #f0f2f5; }
        .customer-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .dashboard-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        .header-title { color: #2c3e50; text-align: center; margin-bottom: 0.5rem; }
        .header-subtitle { color: #7f8c8d; text-align: center; margin-bottom: 2rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #34495e; }
        .input-group input { width: 95%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px; }
        .book-btn { width: 100%; padding: 12px; background-color: #27ae60; color: white; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        .book-btn:hover { background-color: #219150; }
        .book-btn:disabled { background-color: #95a5a6; cursor: not-allowed; }
        .status-message { margin-top: 1.5rem; padding: 1rem; border-radius: 6px; text-align: center; }
        .status-message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

    <div id="root"></div>

    {% raw %}
    <script type="text/babel">
        const CustomerDashboard = () => {
            const [formData, setFormData] = React.useState({
                clientName: '', clientPhone: '', startLocation: '', destination: ''
            });
            const [bookingStatus, setBookingStatus] = React.useState({
                loading: false, message: '', assignedDriver: null
            });

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleBooking = async (e) => {
                e.preventDefault();
                setBookingStatus({ loading: true, message: 'Finding the best EV for you...', assignedDriver: null });

                try {
                    // Note: fetch URL points to where your python app is running
                    const response = await fetch('http://127.0.0.1:5000/api/book-ride', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData),
                    });
                    const data = await response.json();

                    if (response.ok) {
                        setBookingStatus({ loading: false, message: 'Booking Confirmed!', assignedDriver: data.driverDetails });
                    } else {
                        setBookingStatus({ loading: false, message: `Error: ${data.message}`, assignedDriver: null });
                    }
                } catch (error) {
                    console.error('Error:', error);
                    setBookingStatus({ loading: false, message: 'Server connection failed.', assignedDriver: null });
                }
            };

            return (
                <div className="customer-container">
                    <div className="dashboard-card">
                        <h2 className="header-title">âš¡ EV Fleet Booking</h2>
                        <p className="header-subtitle">Book a sustainable ride instantly.</p>
                        <form onSubmit={handleBooking}>
                            <div className="input-group">
                                <label>Client Name</label>
                                <input type="text" name="clientName" onChange={handleChange} required />
                            </div>
                            <div className="input-group">
                                <label>Current Location</label>
                                <input type="text" name="startLocation" onChange={handleChange} required />
                            </div>
                            <div className="input-group">
                                <label>Destination</label>
                                <input type="text" name="destination" onChange={handleChange} required />
                            </div>
                            <button type="submit" className="book-btn" disabled={bookingStatus.loading}>
                                {bookingStatus.loading ? 'Processing...' : 'BOOK RIDE'}
                            </button>
                        </form>
                        {bookingStatus.message && (
                            <div className={`status-message ${bookingStatus.assignedDriver ? 'success' : 'error'}`}>
                                <p>{bookingStatus.message}</p>
                                {bookingStatus.assignedDriver && (
                                    <div style={{marginTop: '10px', fontSize: '0.9rem'}}>
                                        <strong>Driver:</strong> {bookingStatus.assignedDriver.driver} <br/>
                                        <strong>Car:</strong> {bookingStatus.assignedDriver.carId} <br/>
                                        <strong>Battery:</strong> {bookingStatus.assignedDriver.batteryLevel}%
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CustomerDashboard />);
    </script>
    {% endraw %}
    </body>
</html>